% ---------   For analyzing the log of a single session -------------

% Genius directory
genius_dir = '/home/juillermo/eclipse-workspace/The_nego_people/genius/';
% Log file to be read
log_name = 'Log-Session_20171122-234133';


%% Get agents info

oldpath = path;
% Add the path of your logs
path([genius_dir 'log'],oldpath)

tree = xmlread([log_name '.xml']);

% Retrieves agents names and domains
agents = cell(3, 4);
agent_results = tree.getElementsByTagName('resultsOfAgent');
for i=1:3
    agent_result = agent_results.item(i-1); % DOM indexes start at zero
    agent_data = agent_result.getAttributes();
    agents{i,1} = char(agent_data.getNamedItem('agent').getTextContent());
    agents{i,2} = str2double(char(agent_data.getNamedItem('finalUtility').getTextContent()));
    
    utilspace = char(agent_data.getNamedItem('utilspace').getTextContent());
    utilspace = regexp(utilspace, '(.+)\/(.+xml)$', 'tokens');
    agents{i,3} = utilspace{1,1}{1,2};
    util_dir = utilspace{1,1}{1,1};
end

%% Get utilities info

oldpath = path;
% Add the path of the utilities
path([genius_dir util_dir],oldpath)

for i=1:3
    tree = xmlread(agents{i,3});
    issues_tree = tree.getElementsByTagName('issue');
    weights_tree = tree.getElementsByTagName('weight');
    
    issues = cell(issues_tree.getLength, 1);
    for j=1:issues_tree.getLength
        issue = issues_tree.item(j-1); % DOM indexes start at zero
        weight_node = weights_tree.item(j-1);
        
        items_tree = issue.getElementsByTagName('item');
        items = cell(items_tree.getLength, 1);
        for k=1:items_tree.getLength
            item_node = items_tree.item(k-1);
            item_att = item_node.getAttributes();
            
            eval = str2double(char(item_att.getNamedItem('evaluation').getTextContent()));
            value = char(item_att.getNamedItem('value').getTextContent());
            items{k} = struct('value', value, 'eval', eval);
        end
        weight_att = weight_node.getAttributes();
        weight = 
        
        issues{j} = struct('items', items);
    end
    agents{i,4} = issues;
end

agents

%%
%table = readtable([log_name '.csv'], 'ReadVariableNames', false);
